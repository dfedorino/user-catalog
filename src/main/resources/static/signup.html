<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sign Up</title>
</head>
<body>
    <h1>Sign Up</h1>
    <p>Please fill in this form to create an account.</p>
    <hr>

    <label for="login"><b>Login</b></label>
    <p>
        <input type="text" placeholder="Enter Login" name="login" class="login" required>
    </p>


    <label for="email"><b>Email</b></label>
    <p>
        <input type="text" placeholder="Enter Email" name="email" class="email" required>
    </p>


    <label for="phoneNumber"><b>Phone</b></label>
    <p>
        <input type="text" placeholder="Enter Phone Number" name="phone" class="phone" required>
    </p>


    <label for="street"><b>Street</b></label>
    <p>
        <input type="text" placeholder="Enter Street" name="street" class="street" required>
    </p>


    <label for="zipcode"><b>Zip Code</b></label>
    <p>
        <input type="text" placeholder="Enter Zip Code" name="zipcode" class="zipcode" required>
    </p>


    <label for="psw"><b>Password</b></label>
    <p>
        <input type="password" placeholder="Enter Password" name="psw" class="psw" required>
    </p>


    <label for="psw-repeat"><b>Repeat Password</b></label>
    <p>
        <input type="password" placeholder="Repeat Password" name="psw-repeat" required>
    </p>

    <button type="submit" class="signupbtn">Sign Up</button>

    <p id="signupstatus"></p>
    
    <script>
        const login = document.querySelector('.login');
        const email = document.querySelector('.email');
        const phone = document.querySelector('.phone');
        const street = document.querySelector('.street');
        const zip = document.querySelector('.zipcode');
        const password = document.querySelector('.psw');

        const signUpButton = document.querySelector('.signupbtn');

        const signUpStatus = document.getElementById('signupstatus');

        signUpButton.onclick = () => {
            let loginValue = login.value;
            let emailValue = email.value;
            let phoneValue = phone.value;
            let streetValue = street.value;
            let zipValue = zip.value;
            let passwordValue = password.value;
            let user = {
                login: loginValue,
                password: passwordValue,
                email: emailValue,
                contact: {
                        phoneNumber: phoneValue,
                        street: streetValue,
                        zipCode: zipValue
                    }
            }
            sendRequest('POST', 'text', 'http://localhost:8080/users', user)
                .then(d => console.log(d))
                .catch(e => console.log(e));
        }

        function sendRequest(method, type, url, body = null) {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                xhr.open(method, url);
                xhr.responseType = type;
                xhr.setRequestHeader('content-type', 'application/json');
                xhr.onload = () => {
                    let json = xhr.response;
                    if (xhr.status >= 400) {
                        reject(xhr.response);
                        signUpStatus.innerHTML = "Sign Up Failed! Zip Code must not contain digits."
                    } else {
                        resolve(json);
                        signUpStatus.innerHTML = "Sign Up Successful!"
                        window.location.replace("http://localhost:8080");
                    }
                }
                xhr.onerror = () => {
                    reject(xhr.response);
                }
                xhr.send(JSON.stringify(body));
            });
        }
    </script>
</body>
</html>